{% extends "base.html" %}

{% block content %}
<h3 style="margin-bottom: 20px; margin-left: 1%;">{{ record_name }}</h3>
<div class="container">
    {% if msg %}
        <div id="success-message" class="alert alert-success" role="alert">
            {{ msg }}
        </div>
    {% endif %}
    <div class="row">
        <div class="col-md-8">
            <div class="grid">
                {% for target in targets_model %}
                    {% if target.value == 0 %}
                        <div class="square" style="background-color: #e0e0e0" onclick="window.location.href='/target/update_target/{{ record_id }}/{{ target.id }}';">
                            <span class="info">{{ target.value }} - {{ target.added_at }}</span>
                        </div>
                    {% elif target.value > 0 and target.value < average %}
                        <div class="square" style="background-color: #ebd3ff" onclick="window.location.href='/target/update_target/{{ record_id }}/{{ target.id }}';">
                            <span class="info">{{ target.value }} - {{ target.added_at }}</span>
                        </div>
                    {% elif target.value > 0 and target.value - average <= 1 %}
                        <div class="square" style="background-color: #d0adff" onclick="window.location.href='/target/update_target/{{ record_id }}/{{ target.id }}';">
                            <span class="info">{{ target.value }} - {{ target.added_at }}</span>
                        </div>
                    {% elif target.value > 0 and target.value - average > 1 and target.value - average <= 2 %}
                        <div class="square" style="background-color: #b758ff" onclick="window.location.href='/target/update_target/{{ record_id }}/{{ target.id }}';">
                            <span class="info">{{ target.value }} - {{ target.added_at }}</span>
                        </div>
                    {% else %}
                        <div class="square" style="background-color: #6b00e2" onclick="window.location.href='/target/update_target/{{ record_id }}/{{ target.id }}';">
                            <span class="info">{{ target.value }} - {{ target.added_at }}</span>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <div class="statistics">
                <h4>Statistics</h4>
                <p>Total: <strong>{{ total_value }}</strong> {{ record_unit }}</p>
                <p>Average: <strong>{{ average }}</strong> {{ record_unit }}</p>
                <p>Max: <strong>{{ max_value }}</strong> {{ record_unit }}</p>
                <h6>Total targets: {{ number_of_targets }}</h6>
            </div>

            <div class="add-target mt-4">
                <h6>Add New Target or add up to existing</h6>
                <form action="/target/create_target" method="post">
                    <input type="hidden" name="record_id" value="{{ record_id }}">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="input-group">
                                <input type="number" step="0.01" max="99.99" class="form-control" id="value" name="value" placeholder="Value" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-primary w-100">Add Target</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var message = document.getElementById('success-message');
        if (message) {
            setTimeout(function() {
                message.style.opacity = 0;
                message.style.transition = "opacity 0.6s ease-out";
                setTimeout(function() {
                    message.style.display = 'none';
                }, 600); // Time for fade-out transition
            }, 3000); // Time before hiding the message (3 seconds)
        }
    });
</script>
{% endblock %}
